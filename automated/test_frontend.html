<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Metadata Removal Tool</title>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
    font-family:Segoe UI,Tahoma,Verdana,sans-serif;
    background:linear-gradient(135deg,#667eea,#764ba2);
    min-height:100vh;padding:20px
}
.container{max-width:1100px;margin:auto}
.header{text-align:center;color:#fff;margin-bottom:40px}
.card{
    background:#fff;border-radius:15px;padding:30px;
    box-shadow:0 10px 30px rgba(0,0,0,.2);
    margin-bottom:25px
}
.upload-section{text-align:center}
.file-label{
    padding:14px 40px;background:#667eea;color:#fff;
    border-radius:8px;cursor:pointer;display:inline-block
}
.file-label:hover{background:#5568d3}
input[type=file]{display:none}
.btn{
    padding:12px 30px;border:none;border-radius:8px;
    font-weight:600;cursor:pointer;margin:5px
}
.btn-primary{background:#667eea;color:#fff}
.btn-success{background:#48bb78;color:#fff}
.btn:disabled{background:#ccc;cursor:not-allowed}
.file-preview{
    background:#f7fafc;border:2px dashed #cbd5e0;
    border-radius:8px;padding:15px;margin-top:15px
}
.loading{text-align:center}
.spinner{
    width:40px;height:40px;border:4px solid #eee;
    border-top:4px solid #667eea;border-radius:50%;
    animation:spin 1s linear infinite;margin:20px auto
}
@keyframes spin{to{transform:rotate(360deg)}}

.risk-circle{
    width:140px;height:140px;border-radius:50%;
    display:flex;align-items:center;justify-content:center;
    font-size:2.3em;color:#fff;margin:auto
}
.risk-low{background:#48bb78}
.risk-medium{background:#ecc94b}
.risk-high{background:#ed8936}
.risk-critical{background:#f56565}

.metadata-table{width:100%;border-collapse:collapse;margin-top:20px}
.metadata-table th,.metadata-table td{
    padding:12px;border-bottom:1px solid #e2e8f0
}
.badge{padding:4px 12px;border-radius:12px;font-size:.85em}
.badge-low{background:#c6f6d5}
.badge-medium{background:#fef5e7}
.badge-high{background:#feebc8}
.badge-critical{background:#fed7d7}
</style>
</head>

<body>
<div class="container">

<div class="header">
<h1>ðŸ”’ Metadata Removal Tool</h1>
<p>Analyze & remove hidden metadata from images</p>
</div>

<div class="card upload-section">
<input type="file" id="fileInput" accept="image/*">
<label for="fileInput" class="file-label">Choose Image</label>

<div id="filePreview" class="file-preview" style="display:none">
<b>File:</b> <span id="fileName"></span><br>
<b>Size:</b> <span id="fileSize"></span>
</div>

<br><br>
<select id="platform">
<option value="general">General</option>
<option value="instagram">Instagram</option>
<option value="facebook">Facebook</option>
<option value="twitter">Twitter</option>
<option value="linkedin">LinkedIn</option>
</select>

<br><br>
<button class="btn btn-primary" id="analyzeBtn" disabled>Analyze Metadata</button>
<button class="btn btn-success" id="cleanBtn" disabled>Clean & Download</button>
</div>

<div id="loadingSection" class="card" style="display:none">
<div class="loading">
<div class="spinner"></div>
<p>Processing imageâ€¦</p>
</div>
</div>

<div id="resultsSection" class="card" style="display:none">
<h2>Analysis Results</h2>

<div class="risk-circle" id="riskCircle">0</div>
<p id="riskMessage" style="text-align:center;font-weight:600"></p>

<table class="metadata-table">
<thead>
<tr>
<th>Key</th>
<th>Value</th>
<th>Category</th>
<th>Risk</th>
</tr>
</thead>
<tbody id="metadataTableBody"></tbody>
</table>
</div>

</div>

<script>
const API_BASE = "http://localhost:8000/api";

let selectedFile = null;
let isAnalyzing = false;

const fileInput = document.getElementById("fileInput");
const analyzeBtn = document.getElementById("analyzeBtn");
const cleanBtn = document.getElementById("cleanBtn");
const loadingSection = document.getElementById("loadingSection");
const resultsSection = document.getElementById("resultsSection");

fileInput.addEventListener("change", e => {
    selectedFile = e.target.files[0];
    if(!selectedFile) return;

    document.getElementById("fileName").textContent = selectedFile.name;
    document.getElementById("fileSize").textContent = formatFileSize(selectedFile.size);
    document.getElementById("filePreview").style.display = "block";
    analyzeBtn.disabled = false;
});

analyzeBtn.onclick = analyzeFile;

async function analyzeFile(){
    if(!selectedFile || isAnalyzing) return;

    isAnalyzing = true;
    analyzeBtn.disabled = true;
    cleanBtn.disabled = true;

    loadingSection.style.display = "block";
    resultsSection.style.display = "none";

    const formData = new FormData();
    formData.append("file", selectedFile);
    formData.append("platform", platform.value);

    try{
        const res = await fetch(`${API_BASE}/analyze/`,{
            method:"POST",
            body:formData
        });
        const data = await res.json();

        loadingSection.style.display = "none";

        if(!res.ok) throw new Error("Analysis failed");

        renderResults(data);
        resultsSection.style.display = "block";
        cleanBtn.disabled = false;

    }catch(err){
        alert(err.message);
    }finally{
        isAnalyzing = false;
        analyzeBtn.disabled = false;
    }
}

function renderResults(data){
    const riskCircle = document.getElementById("riskCircle");
    const table = document.getElementById("metadataTableBody");

    riskCircle.className = "risk-circle";
    riskCircle.textContent = data.risk_score;

    if(data.risk_score>=75) riskCircle.classList.add("risk-critical");
    else if(data.risk_score>=50) riskCircle.classList.add("risk-high");
    else if(data.risk_score>=25) riskCircle.classList.add("risk-medium");
    else riskCircle.classList.add("risk-low");

    document.getElementById("riskMessage").textContent =
        data.risk_recommendation.message;

    table.innerHTML = "";

    if(data.metadata_entries?.length){
        data.metadata_entries.forEach(e=>{
            table.innerHTML += `
            <tr>
            <td><b>${e.key}</b></td>
            <td>${truncate(e.value,50)}</td>
            <td>${e.category}</td>
            <td><span class="badge badge-${e.risk_level}">${e.risk_level}</span></td>
            </tr>`;
        });
    }else{
        table.innerHTML = `
        <tr>
        <td colspan="4" style="text-align:center;padding:20px">
        âœ… No metadata found
        </td>
        </tr>`;
    }
}

function formatFileSize(bytes){
    if(bytes<1024) return bytes+" B";
    if(bytes<1024*1024) return (bytes/1024).toFixed(2)+" KB";
    return (bytes/1048576).toFixed(2)+" MB";
}
function truncate(str,len){
    return str.length>len?str.slice(0,len)+"â€¦":str;
}
</script>
</body>
</html>
